name: 'frontend-ci'
on: [push]
concurrency:
  group: frontend-ci-${{ github.ref }}
  cancel-in-progress: true

.checkout: &checkout
  name: Checkout Commit
  uses: actions/checkout@v4

.setup-pnpm: &setup-pnpm
  name: Setup pnpm
  uses: pnpm/action-setup@v4
  with:
    run_install: false

.setup-node: &setup-node
  name: Setup Node
  uses: actions/setup-node@v4
  with:
    node-version-file: '.nvmrc'
    cache: 'pnpm'

.install-deps: &install-deps
  name: Install Dependencies
  run: pnpm install

jobs:
  cache-and-install:
    runs-on: ubuntu-latest
    steps:
      - *checkout
      - *setup-pnpm
      - *setup-node
      - *install-deps

  lint:
    runs-on: ubuntu-latest
    needs: cache-and-install
    steps:
      - *checkout
      - *setup-pnpm
      - *setup-node
      - *install-deps
      - name: Run lint
        run: pnpm --filter "./frontend" lint

  typecheck:
    runs-on: ubuntu-latest
    needs: cache-and-install
    steps:
      - *checkout
      - *setup-pnpm
      - *setup-node
      - *install-deps
      - name: Check types
        run: pnpm --filter "./frontend" ts:check

  build:
    runs-on: ubuntu-latest
    needs: [lint, typecheck]
    steps:
      - *checkout
      - *setup-pnpm
      - *setup-node
      - *install-deps
      - name: Run build
        run: pnpm --filter "./frontend" build --no-lint
